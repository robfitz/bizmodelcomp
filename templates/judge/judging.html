{% extends 'base.html' %}

{% block meta %}
{% endblock %}

{% block header %}

	{% include 'judge/judging_header.html' %}

{% endblock %}

{% block ready_script %}

	$('.slider').slider({
		animate: true,
		max: {{max_score}},
		range: 'min',
	});

	{% for question in questions %}
		$('#slider_{{question.id}}').slider('option', 'max', {{question.max_points}});
		max_points[{{question.id}}] = {{question.max_points}};
		$('#slider_{{question.id}}').slider('option', 'value', {{question.score}});
	{% endfor %}

	$('.slider').bind('slidechange', slider_changed);
	$('.slider').bind('slide', slider_changed);

{% endblock %}

{% block script %}

	var max_points = [];

	function slider_changed(event, ui) {
		var tokens = $(this).attr("id").split('_');
		var id = tokens[tokens.length - 1];

		$('#score_label_' + id).val($(this).slider("option", "value"));
	}

{% endblock %}

{% block content %}

	{% load markup %}

	{{ block.super }}

	<form action="." method="POST">

		<input type="hidden" name="pitch" value="{{pitch.pk}}" />

		{% for question in questions %}

			<div class="judge_question">

				{% if question.is_hidden_from_applicants %}
					<div class="judge_application">
					</div>
				{% else %}
					<div class="judge_application">

						<strong class="prompt">{{ question.prompt }}</strong>
						<br/>
						<div style="border:1px solid #ccc;padding:8px;background-color:#eee;">

							{% if question.answer.answer %}

								{{question.answer.answer|markdown}}

							{% else %} {% if question.is_required %}

								(no answer)

							{% endif %}{% endif %}

						</div>

					</div>
				{% endif %}

				<div class="judging">

					{% if question.is_required and question.max_points > 0 %}

						<strong>
							{% if question.judge_points_prompt %}
								{{ question.judge_points_prompt }}
							{% else %}
								Score:
							{% endif %}
						</strong>

						<br/>

						<div class="slider" id="slider_{{question.id}}"></div>
						<div class="score_input">
							<input type="number" min="0" max="{{question.max_points}}" id="score_label_{{question.id}}" value="{{question.score}}" class="score_field" name="answer_{{question.answer.id}}" />
						</div>

						<br/>

					{% endif %}

					{% if question.is_required and question.judge_feedback_prompt %}

						<strong>{{ question.judge_feedback_prompt }}</strong>
						<br/>
						<textarea name="feedback_{{question.id}}">{{question.feedback}}</textarea>

					{% endif %}

				</div>

			</div>

		{% endfor %}

		<p>
		<input type="submit" value="Submit scores & feedback" style="font-size:18px;" />
		</p>



	</form>

{% endblock %}